{% extends "base.html" %}

{% block title %}–ù–æ–≤–æ—Å—Ç–∏{% endblock %}

{% block content %}
<h1>–ù–æ–≤–æ—Å—Ç–∏</h1>

{% if news_list %}
    {% for news in news_list %}
    <article style="border: 1px solid #ddd; padding: 20px; margin-bottom: 20px; position: relative;">
        <h2><a href="{{ url_for('news_detail', news_id=news.id) }}">{{ news.title }}</a></h2>
        <p><small>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: {{ news.created_at.strftime('%d.%m.%Y –≤ %H:%M') }}</small></p>

        <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
        {% if news.images %}
        <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
            {% for image in news.images[:3] %}
            <img src="{{ url_for('static', filename=image.image_path) }}"
                 alt="{{ news.title }}"
                 style="max-width: 150px; height: 100px; object-fit: cover; border-radius: 5px;">
            {% endfor %}
            {% if news.images|length > 3 %}
            <div style="width: 150px; height: 100px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; border-radius: 5px;">
                <span style="color: #666;">+{{ news.images|length - 3 }} —Ñ–æ—Ç–æ</span>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –µ—Å–ª–∏ –µ—Å—Ç—å –≤–∏–¥–µ–æ -->
        {% if news.videos %}
        <div style="margin: 5px 0;">
            <small>üìπ {{ news.videos|length }} –≤–∏–¥–µ–æ</small>
        </div>
        {% endif %}

        <p>{{ news.content[:200] }}{% if news.content|length > 200 %}...{% endif %}</p>
        <a href="{{ url_for('news_detail', news_id=news.id) }}">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ ‚Üí</a>

        <!-- –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô –±–ª–æ–∫ –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ -->
        {% if current_user.is_authenticated and current_user.is_admin %}
        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee;">
            <a href="{{ url_for('edit_news', news_id=news.id) }}"
               style="color: #007bff; font-size: 0.9em; margin-right: 15px;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
            <a href="{{ url_for('delete_news', news_id=news.id) }}"
               onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –Ω–æ–≤–æ—Å—Ç—å? –í—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')"
               style="color: #ff4444; font-size: 0.9em;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
        </div>
        {% endif %}
    </article>
    {% endfor %}

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <div style="display: flex; justify-content: center; margin-top: 30px;">
        <div style="display: flex; gap: 10px; align-items: center;">
            {% if pagination.has_prev %}
                <a href="{{ url_for('news', page=pagination.prev_num) }}"
                   style="padding: 8px 15px; border: 1px solid #ddd; text-decoration: none;">‚Üê –ù–∞–∑–∞–¥</a>
            {% endif %}

            {% for page_num in pagination.iter_pages(left_edge=2, left_current=2, right_current=2, right_edge=2) %}
                {% if page_num %}
                    {% if page_num != pagination.page %}
                        <a href="{{ url_for('news', page=page_num) }}"
                           style="padding: 8px 12px; border: 1px solid #ddd; text-decoration: none;">{{ page_num }}</a>
                    {% else %}
                        <span style="padding: 8px 12px; border: 1px solid #007bff; background: #007bff; color: white;">{{ page_num }}</span>
                    {% endif %}
                {% else %}
                    <span style="padding: 8px 5px;">...</span>
                {% endif %}
            {% endfor %}

            {% if pagination.has_next %}
                <a href="{{ url_for('news', page=pagination.next_num) }}"
                   style="padding: 8px 15px; border: 1px solid #ddd; text-decoration: none;">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
            {% endif %}
        </div>
    </div>

    <div style="text-align: center; margin-top: 10px; color: #666;">
        –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ pagination.page }} –∏–∑ {{ pagination.pages }}
    </div>

{% else %}
    <p>–ü–æ–∫–∞ –Ω–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π.</p>
{% endif %}

<!-- –°—Å—ã–ª–∫–∞ –≤ –∞–¥–º–∏–Ω–∫—É (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) -->
{% if current_user.is_authenticated and current_user.is_admin %}
<hr>
<p><a href="{{ url_for('admin_panel') }}">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a></p>
{% endif %}
{% endblock %}
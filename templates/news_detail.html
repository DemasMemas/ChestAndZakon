{% extends "base.html" %}

{% block title %}{{ news_item.title }}{% endblock %}

{% block content %}
<!-- –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô –±–ª–æ–∫ –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ -->
{% if current_user.is_authenticated and current_user.is_admin %}
<div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px; border-left: 4px solid #007bff;">
    <div style="display: flex; gap: 15px; align-items: center;">
        <span style="font-weight: bold;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç—å—é:</span>
        <a href="{{ url_for('edit_news', news_id=news_item.id) }}"
           style="padding: 8px 15px; background: #007bff; color: white; text-decoration: none; border-radius: 3px;">
           ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        </a>
        <a href="{{ url_for('delete_news', news_id=news_item.id) }}"
           onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –Ω–æ–≤–æ—Å—Ç—å? –í—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')"
           style="padding: 8px 15px; background: #dc3545; color: white; text-decoration: none; border-radius: 3px;">
           üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
        </a>
    </div>
</div>
{% endif %}

<article>
    <h1>{{ news_item.title }}</h1>
    <p><small>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: {{ news_item.created_at.strftime('%d.%m.%Y –≤ %H:%M') }}</small></p>

    <!-- –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
    {% if news_item.images %}
    <div style="margin: 20px 0;">
        <h3>–ì–∞–ª–µ—Ä–µ—è ({{ news_item.images|length }} —Ñ–æ—Ç–æ)</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px;">
            {% for image in news_item.images %}
            <div style="position: relative;">
                <img src="{{ url_for('static', filename=image.image_path) }}"
                     alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ {{ loop.index }}"
                     style="width: 100%; height: 250px; object-fit: contain; cursor: pointer; border: 1px solid #ddd; border-radius: 5px;"
                     onclick="openImageModal('{{ url_for('static', filename=image.image_path) }}')">
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- –í–∏–¥–µ–æ -->
    {% if news_item.videos %}
    <div style="margin: 20px 0;">
        <h3>–í–∏–¥–µ–æ ({{ news_item.videos|length }})</h3>
        <div style="display: grid; gap: 20px;">
            {% for video in news_item.videos %}
            <div>
                <h4>{{ video.title }}</h4>
                {% if video.video_type == 'uploaded' %}
                    <!-- –ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ –≤–∏–¥–µ–æ -->
                    <video controls style="width: 100%; max-height: 500px; background: #000;">
                        <source src="{{ url_for('static', filename=video.video_path) }}" type="video/mp4">
                        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ —Ç–µ–≥.
                    </video>
                {% elif video.video_type == 'youtube' %}
                    <!-- –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ YouTube -->
                    <iframe width="100%" height="400"
                            src="https://www.youtube.com/embed/{{ video.video_url|replace('https://www.youtube.com/watch?v=', '')|replace('https://youtu.be/', '') }}"
                            frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen>
                    </iframe>
                {% elif video.video_type == 'vimeo' %}
                    <!-- –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ Vimeo -->
                    <iframe src="https://player.vimeo.com/video/{{ video.video_url|replace('https://vimeo.com/', '') }}"
                            width="100%" height="400"
                            frameborder="0"
                            allow="autoplay; fullscreen; picture-in-picture"
                            allowfullscreen>
                    </iframe>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- –¢–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏ -->
    <div style="margin-top: 20px; line-height: 1.6;">
        {{ news_item.content|replace('\n', '<br>')|safe }}
    </div>
</article>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
<div id="imageModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9);">
    <span style="position: absolute; top: 15px; right: 35px; color: white; font-size: 40px; font-weight: bold; cursor: pointer;" onclick="closeImageModal()">&times;</span>
    <img id="modalImage" style="margin: auto; display: block; max-width: 90%; max-height: 90%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
</div>

<script>
function openImageModal(imageSrc) {
    document.getElementById('modalImage').src = imageSrc;
    document.getElementById('imageModal').style.display = 'block';
}

function closeImageModal() {
    document.getElementById('imageModal').style.display = 'none';
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
document.getElementById('imageModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeImageModal();
    }
});
</script>

<!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
<div style="margin-top: 40px; border-top: 1px solid #eee; padding-top: 20px;">
    <h3>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h3>
    <form method="POST">
        <div style="margin-bottom: 15px;">
            <label for="author">–í–∞—à–µ –∏–º—è:</label>
            <input type="text" id="author" name="author" required style="width: 300px; padding: 8px;">
        </div>

        <div style="margin-bottom: 15px;">
            <label for="content">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
            <textarea id="content" name="content" rows="4" required style="width: 100%; padding: 8px;"></textarea>
        </div>

        <button type="submit" style="padding: 10px 20px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
    </form>
</div>

<div style="margin-top: 40px;">
    <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ comments_pagination.total }})</h3>

    {% if comments %}
        {% for comment in comments %}
        <div style="border: 1px solid #eee; padding: 15px; margin-bottom: 15px; background: #f9f9f9;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <strong>{{ comment.author }}</strong>
                <small>{{ comment.created_at.strftime('%d.%m.%Y –≤ %H:%M') }}</small>
            </div>
            <p style="margin: 10px 0 0 0;">{{ comment.content }}</p>

            <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) -->
            {% if current_user.is_authenticated and current_user.is_admin %}
            <div style="margin-top: 10px;">
                <a href="{{ url_for('delete_comment', comment_id=comment.id) }}"
                   onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?')"
                   style="color: #ff4444; font-size: 0.9em;">–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</a>
            </div>
            {% endif %}
        </div>
        {% endfor %}

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
        {% if comments_pagination.pages > 1 %}
        <div style="display: flex; justify-content: center; margin-top: 20px;">
            <div style="display: flex; gap: 5px; align-items: center;">
                {% if comments_pagination.has_prev %}
                    <a href="{{ url_for('news_detail', news_id=news_item.id, page=comments_pagination.prev_num) }}"
                       style="padding: 5px 10px; border: 1px solid #ddd; text-decoration: none; font-size: 0.9em;">‚Üê</a>
                {% endif %}

                {% for page_num in comments_pagination.iter_pages(left_edge=1, left_current=1, right_current=1, right_edge=1) %}
                    {% if page_num %}
                        {% if page_num != comments_pagination.page %}
                            <a href="{{ url_for('news_detail', news_id=news_item.id, page=page_num) }}"
                               style="padding: 5px 10px; border: 1px solid #ddd; text-decoration: none; font-size: 0.9em;">{{ page_num }}</a>
                        {% else %}
                            <span style="padding: 5px 10px; border: 1px solid #007bff; background: #007bff; color: white; font-size: 0.9em;">{{ page_num }}</span>
                        {% endif %}
                    {% else %}
                        <span style="padding: 5px 5px; font-size: 0.9em;">...</span>
                    {% endif %}
                {% endfor %}

                {% if comments_pagination.has_next %}
                    <a href="{{ url_for('news_detail', news_id=news_item.id, page=comments_pagination.next_num) }}"
                       style="padding: 5px 10px; border: 1px solid #ddd; text-decoration: none; font-size: 0.9em;">‚Üí</a>
                {% endif %}
            </div>
        </div>
        {% endif %}

    {% else %}
        <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
    {% endif %}
</div>

<div style="margin-top: 30px;">
    <a href="{{ url_for('news') }}">‚Üê –í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏</a>
</div>
{% endblock %}
{% extends "base.html" %}

{% block title %}Добавить новость{% endblock %}

{% block content %}
<h1>Добавить новость</h1>

<form method="POST" enctype="multipart/form-data" id="news-form">
    <div>
        <label for="title">Заголовок:</label>
        <input type="text" id="title" name="title" required style="width: 100%; padding: 8px; margin: 5px 0;">
    </div>

    <div>
        <label for="content">Текст новости:</label>
        <textarea id="content" name="content" rows="10" required style="width: 100%; padding: 8px; margin: 5px 0;"></textarea>
    </div>

    <!-- Блок для множественных изображений -->
    <div style="margin: 20px 0;">
        <h3>Изображения</h3>
        <div id="images-container">
            <div class="image-field">
                <input type="file" name="images" accept="image/*">
                <button type="button" class="remove-image" onclick="removeImageField(this)" style="margin-left: 10px; color: red;">✕</button>
            </div>
        </div>
        <button type="button" onclick="addImageField()" style="margin-top: 10px;">+ Добавить еще изображение</button>
    </div>

    <!-- Блок для множественных видео -->
    <div style="margin: 20px 0;">
        <h3>Добавить видео (необязательно)</h3>
        <div id="videos-container">
            <div class="video-field">
                <select name="video_types" onchange="toggleVideoInput(this)">
                    <option value="vk">VK Видео</option>
                    <option value="rutube">RuTube</option>
                    <option value="uploaded">Загрузить видеофайл</option>
                </select>
                <input type="url" name="video_urls" placeholder="URL видео (VK или RuTube)" style="margin-left: 10px; width: 300px;" class="video-url">
                <input type="file" name="video_files" accept="video/*" style="margin-left: 10px; width: 300px; display: none;" class="video-file">
                <input type="text" name="video_titles" placeholder="Название видео (необязательно)" style="margin-left: 10px; width: 200px;">
                <button type="button" class="remove-video" onclick="removeVideoField(this)" style="margin-left: 10px; color: red;">✕</button>
            </div>
        </div>
        <button type="button" onclick="addVideoField()" style="margin-top: 10px;">+ Добавить еще видео</button>
    </div>

    <button type="submit" style="padding: 10px 20px; margin-top: 10px;">Добавить новость</button>
</form>

<script>
// Функции для динамического добавления полей изображений
function addImageField() {
    const container = document.getElementById('images-container');
    const newField = document.createElement('div');
    newField.className = 'image-field';
    newField.innerHTML = `
        <input type="file" name="images" accept="image/*">
        <button type="button" class="remove-image" onclick="removeImageField(this)" style="margin-left: 10px; color: red;">✕</button>
    `;
    container.appendChild(newField);
}

function removeImageField(button) {
    const fields = document.querySelectorAll('.image-field');
    if (fields.length > 1) {
        button.parentElement.remove();
    }
}

// Функции для динамического добавления полей видео
function addVideoField() {
    const container = document.getElementById('videos-container');
    const newField = document.createElement('div');
    newField.className = 'video-field';
    newField.innerHTML = `
        <select name="video_types" onchange="toggleVideoInput(this)">
            <option value="vk">VK Видео</option>
            <option value="rutube">RuTube</option>
            <option value="uploaded">Загрузить видеофайл</option>
        </select>
        <input type="url" name="video_urls" placeholder="URL видео (VK или RuTube)" style="margin-left: 10px; width: 300px;" class="video-url">
        <input type="file" name="video_files" accept="video/*" style="margin-left: 10px; width: 300px; display: none;" class="video-file">
        <input type="text" name="video_titles" placeholder="Название видео" style="margin-left: 10px; width: 200px;">
        <button type="button" class="remove-video" onclick="removeVideoField(this)" style="margin-left: 10px; color: red;">✕</button>
    `;
    container.appendChild(newField);
}

function removeVideoField(button) {
    const fields = document.querySelectorAll('.video-field');
    if (fields.length > 1) {
        button.parentElement.remove();
    }
}

function toggleVideoInput(select) {
    const field = select.closest('.video-field');
    const urlInput = field.querySelector('.video-url');
    const fileInput = field.querySelector('.video-file');

    if (select.value === 'uploaded') {
        urlInput.style.display = 'none';
        fileInput.style.display = 'inline-block';
        // Убираем required для необязательных полей
        fileInput.removeAttribute('required');
        urlInput.removeAttribute('required');
    } else {
        urlInput.style.display = 'inline-block';
        fileInput.style.display = 'none';
        // Убираем required для необязательных полей
        urlInput.removeAttribute('required');
        fileInput.removeAttribute('required');
    }
}

// Инициализация при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('select[name="video_types"]').forEach(toggleVideoInput);
});
</script>

<a href="{{ url_for('admin_panel') }}">← Назад в админ-панель</a>
{% endblock %}
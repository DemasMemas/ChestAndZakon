{% extends "base.html" %}

{% block title %}–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è{% endblock %}

{% block content %}
<h1>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h1>

<!-- –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
<section style="margin-bottom: 40px;">
    <h2>–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h2>

    {% if events_list %}
        <div style="display: grid; gap: 20px;">
            {% for event in events_list %}
            <div style="border: 1px solid #ddd; padding: 20px; border-radius: 5px; position: relative;">
                <h3><a href="{{ url_for('event_detail', event_id=event.id) }}">{{ event.title }}</a></h3>

                <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                    <div>
                        <strong>–ö–æ–≥–¥–∞:</strong><br>
                        {{ event.event_date.strftime('%d.%m.%Y –≤ %H:%M') }}
                    </div>
                    {% if event.location %}
                    <div>
                        <strong>–ì–¥–µ:</strong><br>
                        {{ event.location }}
                    </div>
                    {% endif %}
                </div>

                {% if event.image_path %}
                <img src="{{ url_for('static', filename=event.image_path) }}" alt="{{ event.title }}" style="max-width: 300px; height: auto; margin-bottom: 15px;">
                {% endif %}

                <p>{{ event.description[:200] }}{% if event.description|length > 200 %}...{% endif %}</p>
                <a href="{{ url_for('event_detail', event_id=event.id) }}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</a>

                <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) -->
                {% if current_user.is_authenticated and current_user.is_admin %}
                <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee;">
                    <a href="{{ url_for('edit_event', event_id=event.id) }}"
                       style="color: #007bff; font-size: 0.9em; margin-right: 15px;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                    <a href="{{ url_for('delete_event', event_id=event.id) }}"
                       onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ?')"
                       style="color: #ff4444; font-size: 0.9em;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
        {% if pagination.pages > 1 %}
        <div style="display: flex; justify-content: center; margin-top: 30px;">
            <div style="display: flex; gap: 10px; align-items: center;">
                {% if pagination.has_prev %}
                    <a href="{{ url_for('events', page=pagination.prev_num) }}"
                       style="padding: 8px 15px; border: 1px solid #ddd; text-decoration: none;">‚Üê –ù–∞–∑–∞–¥</a>
                {% endif %}

                {% for page_num in pagination.iter_pages(left_edge=2, left_current=2, right_current=2, right_edge=2) %}
                    {% if page_num %}
                        {% if page_num != pagination.page %}
                            <a href="{{ url_for('events', page=page_num) }}"
                               style="padding: 8px 12px; border: 1px solid #ddd; text-decoration: none;">{{ page_num }}</a>
                        {% else %}
                            <span style="padding: 8px 12px; border: 1px solid #007bff; background: #007bff; color: white;">{{ page_num }}</span>
                        {% endif %}
                    {% else %}
                        <span style="padding: 8px 5px;">...</span>
                    {% endif %}
                {% endfor %}

                {% if pagination.has_next %}
                    <a href="{{ url_for('events', page=pagination.next_num) }}"
                       style="padding: 8px 15px; border: 1px solid #ddd; text-decoration: none;">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
                {% endif %}
            </div>
        </div>

        <div style="text-align: center; margin-top: 10px; color: #666;">
            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ pagination.page }} –∏–∑ {{ pagination.pages }}
        </div>
        {% endif %}

    {% else %}
        <p>–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π.</p>
    {% endif %}
</section>

<!-- –ü—Ä–æ—à–µ–¥—à–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
{% if past_events %}
<section>
    <h2>–ù–µ–¥–∞–≤–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h2>
    <div style="display: grid; gap: 15px;">
        {% for event in past_events %}
        <div style="border: 1px solid #eee; padding: 15px; border-radius: 5px; background: #f9f9f9;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h4 style="margin: 0;"><a href="{{ url_for('event_detail', event_id=event.id) }}">{{ event.title }}</a></h4>
                    <small>{{ event.event_date.strftime('%d.%m.%Y') }}{% if event.location %} ‚Ä¢ {{ event.location }}{% endif %}</small>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ—à–µ–¥—à–∏—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) -->
                {% if current_user.is_authenticated and current_user.is_admin %}
                <div>
                    <a href="{{ url_for('edit_event', event_id=event.id) }}"
                       style="color: #007bff; font-size: 0.9em; margin-right: 10px;" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                    <a href="{{ url_for('delete_event', event_id=event.id) }}"
                       onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ?')"
                       style="color: #ff4444; font-size: 0.9em;" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</a>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    {% if past_events|length == 10 %}
    <div style="text-align: center; margin-top: 15px;">
        <small>–ü–æ–∫–∞–∑–∞–Ω—ã –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π. <a href="{{ url_for('past_events') }}">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –ø—Ä–æ—à–µ–¥—à–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</a></small>
    </div>
    {% endif %}
</section>
{% endif %}

<!-- –°—Å—ã–ª–∫–∞ –≤ –∞–¥–º–∏–Ω–∫—É (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) -->
{% if current_user.is_authenticated and current_user.is_admin %}
<hr>
<div style="text-align: center;">
    <a href="{{ url_for('admin_panel') }}">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a> |
    <a href="{{ url_for('add_event') }}">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</a>
</div>
{% endif %}
{% endblock %}
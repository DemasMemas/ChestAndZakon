{% extends "base.html" %}

{% block title %}–ü–æ–∏—Å–∫{% endblock %}

{% block content %}
<div class="search-container">
    <h1>–ü–æ–∏—Å–∫ –ø–æ —Å–∞–π—Ç—É</h1>
    
    <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
    <form method="GET" action="{{ url_for('search') }}" style="margin-bottom: 30px;">
        <div style="display: flex; gap: 10px; max-width: 600px;">
            <input type="text" name="q" value="{{ query }}" 
                   placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å..." 
                   style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 5px;">
            <button type="submit" 
                    style="padding: 12px 25px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                üîç –ü–æ–∏—Å–∫
            </button>
        </div>
    </form>

    {% if query %}
        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
        <div class="search-results">
            <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –¥–ª—è "{{ query }}"</h2>
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div style="margin-bottom: 20px; color: #666;">
                –ù–∞–π–¥–µ–Ω–æ: {{ total_news }} –Ω–æ–≤–æ—Å—Ç–µ–π, {{ total_events }} –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
            </div>

            <!-- –ù–æ–≤–æ—Å—Ç–∏ -->
            {% if news_results %}
            <section style="margin-bottom: 40px;">
                <h3>–ù–æ–≤–æ—Å—Ç–∏ ({{ total_news }})</h3>
                {% for news in news_results %}
                <div style="border: 1px solid #eee; padding: 20px; margin-bottom: 15px; border-radius: 5px;">
                    <h4 style="margin-top: 0;">
                        <a href="{{ url_for('news_detail', news_id=news.id) }}">{{ news.title }}</a>
                    </h4>
                    <p style="color: #666; margin-bottom: 10px;">
                        {{ news.created_at.strftime('%d.%m.%Y') }}
                    </p>
                    <p>
                        {% if query in news.content %}
                            ...{{ news.content|replace(query, '<mark>' + query + '</mark>')|safe }}...
                        {% else %}
                            {{ news.content[:200] }}...
                        {% endif %}
                    </p>
                    <a href="{{ url_for('news_detail', news_id=news.id) }}">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ</a>
                </div>
                {% endfor %}

                <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π -->
                {% if news_pagination.pages > 1 %}
                <div style="display: flex; justify-content: center; margin-top: 20px;">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        {% if news_pagination.has_prev %}
                            <a href="{{ url_for('search', q=query, page=news_pagination.prev_num) }}" 
                               style="padding: 8px 15px; border: 1px solid #ddd; text-decoration: none;">‚Üê –ù–∞–∑–∞–¥</a>
                        {% endif %}
                        
                        {% for page_num in news_pagination.iter_pages(left_edge=1, left_current=1, right_current=1, right_edge=1) %}
                            {% if page_num %}
                                {% if page_num != news_pagination.page %}
                                    <a href="{{ url_for('search', q=query, page=page_num) }}" 
                                       style="padding: 8px 12px; border: 1px solid #ddd; text-decoration: none;">{{ page_num }}</a>
                                {% else %}
                                    <span style="padding: 8px 12px; border: 1px solid #007bff; background: #007bff; color: white;">{{ page_num }}</span>
                                {% endif %}
                            {% else %}
                                <span style="padding: 8px 5px;">...</span>
                            {% endif %}
                        {% endfor %}
                        
                        {% if news_pagination.has_next %}
                            <a href="{{ url_for('search', q=query, page=news_pagination.next_num) }}" 
                               style="padding: 8px 15px; border: 1px solid #ddd; text-decoration: none;">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </section>
            {% endif %}

            <!-- –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
            {% if events_results %}
            <section style="margin-bottom: 40px;">
                <h3>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è ({{ total_events }})</h3>
                {% for event in events_results %}
                <div style="border: 1px solid #eee; padding: 20px; margin-bottom: 15px; border-radius: 5px;">
                    <h4 style="margin-top: 0;">
                        <a href="{{ url_for('event_detail', event_id=event.id) }}">{{ event.title }}</a>
                    </h4>
                    <div style="color: #666; margin-bottom: 10px;">
                        <strong>–ö–æ–≥–¥–∞:</strong> {{ event.event_date.strftime('%d.%m.%Y –≤ %H:%M') }}
                        {% if event.location %}
                        <br><strong>–ì–¥–µ:</strong> {{ event.location }}
                        {% endif %}
                    </div>
                    <p>
                        {% if query in event.description %}
                            ...{{ event.description|replace(query, '<mark>' + query + '</mark>')|safe }}...
                        {% else %}
                            {{ event.description[:200] }}...
                        {% endif %}
                    </p>
                    <a href="{{ url_for('event_detail', event_id=event.id) }}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                </div>
                {% endfor %}
            </section>
            {% endif %}

            <!-- –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ -->
            {% if not news_results and not events_results %}
            <div style="text-align: center; padding: 40px; color: #666;">
                <p>–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∏—Å–∫–∞—Ç—å –ø–æ –¥—Ä—É–≥–∏–º —Å–ª–æ–≤–∞–º.</p>
            </div>
            {% endif %}
        </div>
    {% else %}
        <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –∫–æ–≥–¥–∞ –∑–∞–ø—Ä–æ—Å –ø—É—Å—Ç–æ–π -->
        <div style="text-align: center; padding: 40px; color: #666;">
            <p>–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤ –ø–æ–ª–µ –≤—ã—à–µ.</p>
            <p>–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–∫–∞—Ç—å –ø–æ –Ω–æ–≤–æ—Å—Ç—è–º –∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è–º.</p>
        </div>
    {% endif %}
</div>

<style>
mark {
    background-color: #fff3cd;
    padding: 2px 4px;
    border-radius: 2px;
}
</style>
{% endblock %}